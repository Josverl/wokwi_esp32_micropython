{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "options": {
        "cwd": "${workspaceFolder}",
        "env": {
            "PORT_BOARD": "rp2-pico",
            "firmware_bin": "${workspaceFolder}/firmware/esp32-20230426-v1.20.0.bin",
            "littlefs_image": "${workspaceFolder}/build/littlefs.img",
            "firmware_lfs_bin": "${workspaceFolder}/build/firmware_lfs.bin",
        }
    },
    "tasks": [
        {
            "label": "create_littlefs",
            "detail": "Create littlefs image from files in the .\\src folder",
            "type": "shell",
            "windows": {
                "command": "${command:python.interpreterPath} tools/create_littlefs.py"
            },
            "linux": {
                "command": "python3 tools/create_littlefs.py"
            },
            "group": {
                "kind": "build"
            },
            "problemMatcher": []
        },
        {
            "label": "merge_littlefs_bin",
            "detail": "esp32: Merge a littlefs image into a ESP32 firmware image",
            "dependsOn": "create_littlefs",
            "type": "shell",
            "windows": {
                "command": "esptool --chip esp32 merge_bin -o $env:firmware_lfs_bin --flash_mode dio --flash_size 4MB 0x1000 $env:firmware_bin 0x200000 $env:littlefs_image"
            },
            "linux": {
                "command": "esptool.py --chip esp32 merge_bin -o ${firmware_lfs_bin} --flash_mode dio --flash_size 4MB 0x1000 ${firmware_bin} 0x200000 ${littlefs_image}"
            },
            "group": {
                "kind": "build"
            }
        },
        {
            "label": "merge_littlefs_uf2",
            "detail": "rp2-pico: Merge a littlefs image into a ESP32 firmware image",
            "dependsOn": "create_littlefs",
            "type": "shell",
            "command": "${command:python.interpreterPath} tools/uf2_merge.py",
            "group": {
                "kind": "build"
            }
        },
        {
            "label": "upload via mpremote",
            "detail": "Upload the source to the board via mpremote, import boot and main",
            "type": "shell",
            "command": "${command:python.interpreterPath}",
            "args": [
                " -m mpremote connect rfc2217://localhost:4000 cp -r src/ : + exec --no-follow 'import boot;import main'"
            ],
            "group": {
                "kind": "build"
            }
        },
        {
            "label": "Start WokWi emulator",
            "detail": "Load the source files and (re)Start the WokWi emulator",
            "dependsOn": "merge_littlefs_uf2",
            "command": "${command:wokwi-vscode.start}",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": []
        }
    ]
}